<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25" zv="Cache for Windows (x86-64) 2016.2.1 (Build 803)" ts="2017-03-22 14:55:56">
<Class name="Training.DeepSee.Movie">
<Super>%Persistent,%XML.Adaptor</Super>
<TimeChanged>64363,40245.468551</TimeChanged>
<TimeCreated>62717,57022.720582</TimeCreated>

<Parameter name="DSTIME">
<Default>AUTO</Default>
</Parameter>

<Property name="Name">
<Type>%String</Type>
<Parameter name="MAXLEN" value="100"/>
</Property>

<Property name="ReleaseDate">
<Type>%Date</Type>
</Property>

<Property name="Genre">
<Type>%String</Type>
</Property>

<Property name="Director">
<Type>%String</Type>
</Property>

<UDLText name="T">
<Content><![CDATA[
// Property Plot As %Stream.GlobalCharacter;

]]></Content>
</UDLText>

<Property name="Rating">
<Type>%Numeric</Type>
</Property>

<Method name="AddPlot">
<ClassMethod>1</ClassMethod>
<FormalSpec>dir:%String="C:\DeepSee\iKnow\Movies\"</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	Set tSC=$$$OK
	Try {
		Set rs = ##class(%ResultSet).%New("Training.DeepSee.Movie:Extent")
		Set tSC = rs.Execute()
		While rs.Next()
		{
			Set id= rs.Get("ID")
			Set movie = ##class(Training.DeepSee.Movie).%OpenId(id)
			Set fileName = dir_movie.Name_".txt"
			Set file = ##class(%File).%New(fileName)
			Do file.Open("RU")
			write !,fileName
			
			Set tSC=movie.Plot.CopyFrom(file) 
			Set tSC=movie.%Save()
				
		}
		
	}
	
	
	Catch ex {
		
		Set tSC = ex.AsStatus()
		
	}
	
	Quit tSC
]]></Implementation>
</Method>

<Method name="ExportAllToFile">
<ClassMethod>1</ClassMethod>
<FormalSpec>file:%String="C:\DeepSee\iKnow\moviedata.xml"</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set tSC=$$$OK
	Set count=0
	try {
		
		Set rs = ##class(%ResultSet).%New("Training.DeepSee.Movie:Extent")
		Set tSC = rs.Execute()
		$$$ThrowOnError(tSC)
		Set writer=##class(%XML.Writer).%New()
		Do writer.OutputToFile(file)
		Do writer.RootElement("Movies")
		Set writer.Indent=1
		While (rs.Next()){
			
			Set obj=##class(Training.DeepSee.Movie).%OpenId(rs.Get("ID"))
			Set tSC=writer.Object(obj,"Movie")
			$$$ThrowOnError(tSC)
			Set count=count+1
			//Quit:count=50
			
		}
		Do writer.EndRootElement()
	}
	
	catch ex {
		
		Set tSC=ex.AsStatus()
		CLOSE file
		
	}
	Write count_" movies exported"
	Quit tSC
]]></Implementation>
</Method>

<Method name="LoadData">
<ClassMethod>1</ClassMethod>
<FormalSpec>file:%String="c:\DeepSee\iKnow\moviedata.xml"</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[

	Set tSC=$$$OK
	Set count=0
		try{	
		Set reader=##class(%XML.Reader).%New()
		Set tSC=reader.OpenFile(file)
		$$$ThrowOnError(tSC)
	
		Do reader.Correlate("Movie","Training.DeepSee.Movie")
	
		While (reader.Next(.object,.status)){
	 		set tSC=object.%Save()
	 		$$$ThrowOnError(tSC)
	 		Set count=count+1 
		}
	}
	
	catch ex {
		
		Set tSC=ex.AsStatus()
		CLOSE file
		
	}
	Write count_" movies imported"
	Quit tSC
]]></Implementation>
</Method>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^Training.DeepSee.MovieD</DataLocation>
<DefaultData>MovieDefaultData</DefaultData>
<IdLocation>^Training.DeepSee.MovieD</IdLocation>
<IndexLocation>^Training.DeepSee.MovieI</IndexLocation>
<StreamLocation>^Training.DeepSee.MovieS</StreamLocation>
<ExtentSize>100000</ExtentSize>
<Data name="MovieDefaultData">
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>Name</Value>
</Value>
<Value name="3">
<Value>ReleaseDate</Value>
</Value>
<Value name="4">
<Value>Genre</Value>
</Value>
<Value name="5">
<Value>Director</Value>
</Value>
<Value name="6">
<Value>Plot</Value>
</Value>
<Value name="7">
<Value>Rating</Value>
</Value>
</Data>
</Storage>
</Class>
</Export>
